{%
locations = {}
for post in site.posts() do
  if post.location and post.location.latitude and post.location.longitude then
    table.insert(locations, {
      type = "Feature",
      geometry = {
        type = "Point",
        coordinates = { post.location.longitude, post.location.latitude }
      },
      properties = {
        title = post.title,
        icon = post.thumbnail and post.thumbnail.url,
      },
    })
  end
end
collection = {
  type = "FeatureCollection",
  features = locations
}
%}

{{ json(collection) }}